{% extends "base.html" %}

{% block title %}Results - {{ topic.name }}{% endblock %}

{% block content %}
<div class="page">
    <div class="results-container">
        <!-- Score Circle -->
        <div class="score-circle" style="--score-percent: {{ percentage }};">
            <div class="score-circle__bg">
                <span class="score-value">{{ percentage }}%</span>
                <span class="score-label">Score</span>
                <span class="score-fraction">{{ score }} / {{ total }}</span>
            </div>
        </div>

        <!-- Topic Badge -->
        <div class="quiz-topic flex-center mb-lg">
            <span class="quiz-topic__icon">{{ topic.icon }}</span>
            <span class="quiz-topic__name">{{ topic.name }} Quiz Complete!</span>
        </div>

        <!-- AI Feedback Card -->
        <div class="feedback-card">
            <div class="feedback-card__title">
                <span class="feedback-card__icon">ðŸ¤–</span>
                <h3>AI Feedback</h3>
            </div>
            <p class="feedback-card__text">{{ feedback }}</p>
        </div>

        <!-- Results Breakdown -->
        <div class="results-breakdown">
            <h3 class="results-breakdown__title">Question Breakdown</h3>

            {% for result in results %}
            <div
                class="result-item {% if result.is_correct %}result-item--correct{% else %}result-item--incorrect{% endif %}">
                <div class="result-item__status">
                    {% if result.is_correct %}âœ“{% else %}âœ—{% endif %}
                </div>
                <div class="result-item__content">
                    <p class="result-item__question">{{ loop.index }}. {{ result.question }}</p>
                    {% if result.user_answer >= 0 %}
                    <p
                        class="result-item__answer {% if result.is_correct %}result-item__answer--correct{% else %}result-item__answer--incorrect{% endif %}">
                        Your answer: {{ result.options[result.user_answer] }}
                        {% if not result.is_correct %}
                        <br><span style="color: var(--accent-success);">Correct: {{ result.options[result.correct_index]
                            }}</span>
                        {% endif %}
                    </p>
                    {% else %}
                    <p class="result-item__answer result-item__answer--incorrect">
                        Not answered
                        <br><span style="color: var(--accent-success);">Correct: {{ result.options[result.correct_index]
                            }}</span>
                    </p>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Action Buttons -->
        <div class="flex-center gap-md">
            <a href="{{ url_for('index') }}" class="btn btn--primary btn--large">
                ðŸ”„ Play Again
            </a>
        </div>

        <!-- Footer -->
        <p class="text-center mt-lg" style="color: var(--text-muted); font-size: 0.875rem;">
            Questions generated by TinyLlama AI
        </p>
    </div>
</div>
{% endblock %}